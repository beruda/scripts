"""
Tests for voting ??/05/2023
"""
from brownie import interface, ZERO_ADDRESS, ProtocolDebugBinder
from utils.config import (
    contracts,
    lido_dao_node_operators_registry,
    lido_dao_voting_address,
    lido_dao_steth_address,
    lido_dao_legacy_oracle,
    lido_dao_withdrawal_vault,
    ldo_holder_address_for_tests,
    deployer_eoa,
)
from utils.test.tx_tracing_helpers import *
from utils.test.event_validators.permission import Permission, validate_permission_create_event
from scripts.bind_debug import bind
from utils.shapella_upgrade import (
    prepare_deploy_gate_seal_mock,
    prepare_deploy_upgrade_template,
    prepare_upgrade_locator,
    prepare_transfer_ownership_to_template,
)


# see Lido's proxy appId()
LIDO_APP_ID = "0x3ca7c3e38968823ccb4c78ea688df41356f182ae1d159e4ee608d30d68cef320"
LIDO_IMPL = "0xE5418393B2D9D36e94b7a8906Fb2e4E9dce9DEd3"
LIDO_APP_VERSION = (4, 0, 0)

# see NodeOperatorsRegistry's proxy appId()
NODE_OPERATORS_REGISTRY_APP_ID = "0x7071f283424072341f856ac9e947e7ec0eb68719f757a7e785979b6b8717579d"
NODE_OPERATORS_REGISTRY_IMPL = "0x18Ce1d296Cebe2596A5c295202a195F898021E5D"
NODE_OPERATORS_REGISTRY_APP_VERSION = (4, 0, 0)

# see LidoOracle's proxy appId()
ORACLE_APP_ID = "0x8b47ba2a8454ec799cd91646e7ec47168e91fd139b23f017455f3e5898aaba93"
ORACLE_IMPL = "0xCb461e10f5AD0575172e7261589049e44aAf209B"
ORACLE_APP_VERSION = (4, 0, 0)


# New addresses
TEMPLATE_ADDRESS = "0xc601E93D9F48D5E374820957CdA57516e2523d6C"
LIDO_LOCATOR = "0xC1d0b3DE6792Bf6b4b37EccdcC24e45978Cfd2Eb"
LIDO_LOCATOR_IMPL = "0x2faE8f0A4D8D11B6EC35d04d3Ea6a0d195EB6D3F"
BURNER = "0x0359bC6ef9425414f9b22e8c9B877080B52793F5"
EIP_712_STETH = "0x075CEf9752b42e332Dab0bae1Ca63801AD8E28C7"
ACCOUNTING_ORACLE = "0x010ecB2Af743c700bdfAF5dDFD55Ba3c07dcF9Df"
ACCOUNTING_ORACLE_IMPL = "0xE1987a83C5427182bC70FFDC02DBf51EB21B1115"
VALIDATORS_EXIT_BUS_ORACLE = "0xAE5f30D1494a7B29A9a6D0D05072b6Fb092e7Ad2"
VALIDATORS_EXIT_BUS_ORACLE_IMPL = "0xAb6Feb60775FbeFf855c9a3cBdE64F2f3e1B03fD"
STAKING_ROUTER = "0xaE2D1ef2061389e106726CFD158eBd6f5DE07De5"
STAKING_ROUTER_IMPL = "0x9BcF19B36770969979840A91d1b4dc352b1Bd648"
WITHDRAWAL_QUEUE = "0xa2ECee311e61EDaf4a3ac56b437FddFaCEd8Da80"
WITHDRAWAL_QUEUE_IMPL = "0x8e625031D47721E5FA1D13cEA033EC1dd067F663"
HASH_CONSENSUS_FOR_ACCOUNTING_ORACLE = "0x64bc157ec2585FAc63D33a31cEd56Cee4cB421eA"
HASH_CONSENSUS_FOR_VALIDATORS_EXIT_BUS_ORACLE = "0x8D108EB23306c9F860b1F667d9Fcdf0dA273fA89"
GATE_SEAL = "0x32429d2AD4023A6fd46a690DEf62bc51990ba497"
DEPOSIT_SECURITY_MODULE = "0x0dCa6e1cc2c3816F1c880c9861E6c2478DD0e052"
WITHDRAWAL_VAULT_IMPLEMENTATION = "0xcd26Aa57a3DC7015A7FCD7ECBb51CC4E291Ff0c5"

#
# Roles section
# NB: role hash calculated as keccak256 of constant name, e.g. DEFAULT_ADMIN_ROLE = keccak256("DEFAULT_ADMIN_ROLE")
#
# Default OpenZeppelin roles
DEFAULT_ADMIN_ROLE = "0x0000000000000000000000000000000000000000000000000000000000000000"
# Burner roles
REQUEST_BURN_SHARES_ROLE = "0x4be29e0e4eb91f98f709d98803cba271592782e293b84a625e025cbb40197ba8"
# HashConsensus roles
MANAGE_MEMBERS_AND_QUORUM_ROLE = "0x66a484cf1a3c6ef8dfd59d24824943d2853a29d96f34a01271efc55774452a51"
# AccountingOracle and ValidatorsExitBusOracle pausable roles
PAUSE_ROLE = "0x139c2898040ef16910dc9f44dc697df79363da767d8bc92f2e310312b816e46d"
RESUME_ROLE = "0x2fc10cc8ae19568712f7a176fb4978616a610650813c9d05326c34abb62749c7"
# WithdrawalQueue roles
FINALIZE_ROLE = "0x485191a2ef18512555bd4426d18a716ce8e98c80ec2de16394dcf86d7d91bc80"
ORACLE_ROLE = "0x68e79a7bf1e0bc45d0a330c573bc367f9cf464fd326078812f301165fbda4ef1"
# StakingRouter roles
STAKING_MODULE_PAUSE_ROLE = "0x00b1e70095ba5bacc3202c3db9faf1f7873186f0ed7b6c84e80c0018dcc6e38e"
STAKING_MODULE_MANAGE_ROLE = "0x3105bcbf19d4417b73ae0e58d508a65ecf75665e46c2622d8521732de6080c48"
REPORT_EXITED_VALIDATORS_ROLE = "0xc23292b191d95d2a7dd94fc6436eb44338fda9e1307d9394fd27c28157c1b33c"
REPORT_REWARDS_MINTED_ROLE = "0x779e5c23cb7a5bcb9bfe1e9a5165a00057f12bcdfd13e374540fdf1a1cd91137"
# Aragon new role
STAKING_ROUTER_ROLE = "0xbb75b874360e0bfd87f964eadd8276d8efb7c942134fc329b513032d0803e0c6"
# Aragon roles to revoke
MANAGE_FEE = "0x46b8504718b48a11e89304b407879435528b3cd3af96afde67dfe598e4683bd8"
MANAGE_WITHDRAWAL_KEY = "0x46b8504718b48a11e89304b407879435528b3cd3af96afde67dfe598e4683bd8"
MANAGE_PROTOCOL_CONTRACTS_ROLE = "0xeb7bfce47948ec1179e2358171d5ee7c821994c911519349b95313b685109031"
SET_EL_REWARDS_VAULT_ROLE = "0x9d68ad53a92b6f44b2e8fb18d211bf8ccb1114f6fafd56aa364515dfdf23c44f"
SET_EL_REWARDS_WITHDRAWAL_LIMIT_ROLE = "0xca7d176c2da2028ed06be7e3b9457e6419ae0744dc311989e9b29f6a1ceb1003"
ADD_NODE_OPERATOR_ROLE = "0xe9367af2d321a2fc8d9c8f1e67f0fc1e2adf2f9844fb89ffa212619c713685b2"
SET_NODE_OPERATOR_ACTIVE_ROLE = "0xd856e115ac9805c675a51831fa7d8ce01c333d666b0e34b3fc29833b7c68936a"
SET_NODE_OPERATOR_NAME_ROLE = "0x58412970477f41493548d908d4307dfca38391d6bc001d56ffef86bd4f4a72e8"
SET_NODE_OPERATOR_ADDRESS_ROLE = "0xbf4b1c236312ab76e456c7a8cca624bd2f86c74a4f8e09b3a26d60b1ce492183"
REPORT_STOPPED_VALIDATORS_ROLE = "0x18ad851afd4930ecc8d243c8869bd91583210624f3f1572e99ee8b450315c80f"
MANAGE_MEMBERS = "0xbf6336045918ae0015f4cdb3441a2fdbfaa4bcde6558c8692aac7f56c69fb067"
MANAGE_QUORUM = "0xa5ffa9f45fa52c446078e834e1914561bd9c2ab1e833572d62af775da092ccbc"
SET_BEACON_SPEC = "0x16a273d48baf8111397316e6d961e6836913acb23b181e6c5fb35ec0bd2648fc"
SET_REPORT_BOUNDARIES = "0x44adaee26c92733e57241cb0b26ffaa2d182ed7120ba3ecd7e0dce3635c01dc1"
SET_BEACON_REPORT_RECEIVER = "0xe22a455f1bfbaf705ac3e891a64e156da92cb0b42cfc389158e6e82bd57f37be"

# New parameters
STAKING_MODULE_NOR_ID = 1
STAKING_MODULE_NOR_NAME = "curated-onchain-v1"
STAKING_MODULE_NOR_TYPE = (
    "0x637572617465642d6f6e636861696e2d76310000000000000000000000000000"  # bytes32("curated-onchain-v1");
)

LIDO_ORACLE_QUORUM = 5
LIDO_ORACLE_COMMITTEE_MEMBERS = (
    "0x140Bd8FbDc884f48dA7cb1c09bE8A2fAdfea776E",
    "0x1d0813bf088BE3047d827D98524fBf779Bc25F00",
    "0x404335BcE530400a5814375E7Ec1FB55fAff3eA2",
    "0x946D3b081ed19173dC83Cd974fC69e1e760B7d78",
    "0x007DE4a5F7bc37E2F26c0cb2E8A95006EE9B89b5",
    "0xEC4BfbAF681eb505B94E4a7849877DC6c600Ca3A",
    "0x61c91ECd902EB56e314bB2D5c5C07785444Ea1c8",
    "0x1Ca0fEC59b86F549e1F1184d97cb47794C8Af58d",
    "0xA7410857ABbf75043d61ea54e07D57A6EB6EF186",
)

DEPOSIT_SECURITY_MODULE_GUARDIANS = (
    "0x5fd0dDbC3351d009eb3f88DE7Cd081a614C519F1",
    "0x7912Fa976BcDe9c2cf728e213e892AD7588E6AaF",
    "0x14D5d5B71E048d2D75a39FfC5B407e3a3AB6F314",
    "0xf82D88217C249297C6037BA77CE34b3d8a90ab43",
    "0xa56b128Ea2Ea237052b0fA2a96a387C0E43157d8",
    "0xd4EF84b638B334699bcf5AF4B0410B8CCD71943f",
)
DEPOSIT_SECURITY_MODULE_GUARDIANS_QUORUM = 4

# type(uint256).max
TYPE_UINT256_MAX = 2**256 - 1

# PAUSE_INFINITELY from PausableUntil.sol
PAUSE_INFINITELY = TYPE_UINT256_MAX

# 0x01...withdrawal_vault or Lido.getWithdrawalCredentials()
WITHDRAWAL_CREDENTIALS = "0x010000000000000000000000b9d7934878b5fb9610b3fe8a5e441e8fad7e293f"


EPOCHS_PER_FRAME_FOR_ACCOUNTING_ORACLE = 225
EPOCHS_PER_FRAME_FOR_VALIDATORS_EXIT_BUS_ORACLE = 56

# Deployment parameter
STUCK_PENALTY_DELAY = 432000

# Helper constant to mark that value of an event field is not checked
ANY_VALUE = None


def test_vote(
    helpers,
    bypass_events_decoding,
    vote_ids_from_env,
    accounts,
):
    bind({"from": deployer_eoa})
